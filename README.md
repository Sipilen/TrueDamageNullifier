# TrueDamageNullifier

[![GitHub release](https://img.shields.io/github/v/release/sipilen/TrueDamageNullifier?color=blue)](https://github.com/sipilen/TrueDamageNullifier/releases) [![SpigotMC](https://img.shields.io/badge/SpigotMC-Approved-green.svg)](https://www.spigotmc.org/resources/truedamagenullifier.129837/) [![License](https://img.shields.io/github/license/sipilen/TrueDamageNullifier.svg)](https://github.com/sipilen/TrueDamageNullifier/blob/main/LICENSE)

**TrueDamageNullifier** — это плагин для серверов на Bukkit/Spigot (API 1.16+), предназначенный для гибкого управления модификаторами урона в PvP-сражениях. Он позволяет админам отключать, уменьшать или усиливать урон между игроками, с привязкой к UUID (для перманентности), IP-адресу (для альтов) и никам (для простоты). Плагин предотвращает обходы (смена ника/IP/VPN), автоматически отслеживает альт-аккаунты и уведомляет админов о подозрительных входах. Все настройки сохраняются в `config.yml`, временные эффекты истекают автоматически. Сообщения настраиваются в `messages.yml`.

Плагин совместим со старыми конфигурациями и поддерживает автодополнение команд (TAB). Модификаторы применяются только в PvP (игрок vs игрок, включая снаряды); PvE, падения и другие типы урона не затрагиваются.

## Особенности
- **Модификаторы урона:** DISABLED (отключение PvP), REDUCED (снижение в 3 раза), AMPLIFIED (увеличение в 4 раза).
- **Привязки:** Автоматическая к UUID/IP/нику для анти-обхода.
- **Альты:** Отслеживание истории ников по IP, уведомления админам при входе альта с активным модом.
- **Автоматика:** Применение на join, истечение эффектов, авто-bind.
- **Команды:** 15+ команд с TAB-complete, правами и примерами.
- **Конфиг:** YAML, авто-очистка старых данных, reload без рестарта.
- **Лёгкость:** Без зависимостей, низкая нагрузка.

## Установка
1. Скачайте JAR-файл из [релизов](https://github.com/sipilen/TrueDamageNullifier/releases).
2. Поместите в папку `plugins/`.
3. Перезапустите сервер.
4. Настройте права в `permissions.yml` или плагине (LuckPerms).
5. Отредактируйте `messages.yml` (опционально) и перезагрузите `/tdn reload`.

**Зависимости:** Нет (Bukkit/Spigot 1.16+).

## Описание модификаторов урона

Каждый игрок может иметь один из следующих модификаторов, влияющих на PvP-сражения. Модификаторы применяются с приоритетом: UUID (перманентный) > IP (альты) > текущий ник. Если игрок меняет ник или IP, mod следует за ним автоматически.

| Модификатор | Действие | Применение |
|-------------|----------|------------|
| **DISABLED** | Игрок не может наносить урон другим игрокам (PvP отключён), но может получать урон. Блокирует прямые атаки и снаряды (стрелы и т.д.). При попытке атаки игроку показывается сообщение с причиной и временем. | Может быть временным или постоянным (0). Причина обязательна для временных (показывается игроку). Привязка к UUID/IP/нику для отслеживания альтов. |
| **REDUCED** | Урон, наносимый игроком, снижается на 1/3 (event.setDamage(damage / 3.0)). | Может быть временным или постоянным. Причина не указывается. Привязка к UUID/IP/нику. |
| **AMPLIFIED** | Игрок получает в 4 раза больше урона от других игроков (event.setDamage(damage * 4.0)). | Может быть временным или постоянным. Причина не указывается. Привязка к UUID/IP/нику. |
| **NORMAL** | Модификатор отсутствует, PvP работает стандартно. | По умолчанию. Автоматический сброс по истечении времени или команде clear. |

**Дополнительно:**
- **Привязки:** Автоматическая (на join/команде): IP/UUID → original nick. Моды сохраняются перманентно.
- **Альты:** Автоматическое отслеживание ников по IP. Уведомления админам при входе альта с активным mod.
- **Истечение:** Автоматически каждую секунду. Сброс с сообщением "PvP включен".

## Команды и права доступа

Для управления модификаторами используются следующие команды и права доступа. Все команды поддерживают автодополнение (TAB): имена игроков, время (30s/1m/1h/0), ники из истории.

### Права доступа

| Право | Описание | По умолчанию |
|-------|----------|--------------|
| `tdn.use` | Базовое использование. | op |
| `tdn.admin` | Полный доступ (reload, list, nicklist, уведомления об альтах). | op |
| `tdn.list` | Просмотр списка модификаторов игроков. | op |
| `tdn.nicklist` | Просмотр списка по никам/IP/альтам. | op |
| `tdn.alts` | Просмотр альт-аккаунтов по нику. | op |
| `tdn.clear` | Снятие модификаторов с игрока. | op |
| `tdn.nickclear` | Снятие по нику/IP. | op |
| `tdn.ipclear` | Снятие по IP (через ник). | op |
| `tdn.disable` | Отключение урона для игрока. | op |
| `tdn.ipdisable` | Отключение по нику/IP/UUID. | op |
| `tdn.reduce` | Снижение урона для игрока. | op |
| `tdn.ipreduce` | Снижение по нику/IP/UUID. | op |
| `tdn.amplify` | Увеличение урона для игрока. | op |
| `tdn.ipamplify` | Увеличение по нику/IP/UUID. | op |
| `tdn.status` | Просмотр статуса модификатора игрока. | op |

### Команды

| Команда | Описание | Параметры | Пример |
|---------|----------|-----------|--------|
| `/tdn disable <игрок> <время> <причина>` | Отключает PvP для указанного игрока (UUID-based). Авто-bind UUID к нику. Игрок не может наносить урон другим, но может получать его. Можно указать причину, которая будет показываться игроку при попытке атаковать. | `<игрок>` (онлайн), `<время>` (30s/5m/1h/0), `<причина>` (опционально). | `/tdn disable Steve 10m Нарушение правил` |
| `/tdn reduce <игрок> <время>` | Снижает урон, наносимый этим игроком, до 1/3 (UUID-based). Авто-bind UUID. | `<игрок>` (онлайн), `<время>` (5m/0 и т.д.). | `/tdn reduce Alex 5m` |
| `/tdn amplify <игрок> <время>` | Все другие игроки наносят этому игроку в 4 раза больше урона (UUID-based). Авто-bind UUID. | `<игрок>` (онлайн), `<время>` (5m/0 и т.д.). | `/tdn amplify Bob 1h` |
| `/tdn status <игрок>` | Показывает текущий модификатор урона игрока, оставшееся время его действия и причину (если есть). | `<игрок>` (онлайн). | `/tdn status Steve` |
| `/tdn reload` | Перезагружает конфигурацию плагина из файла, позволяя применить изменения без перезапуска сервера. Очищает и перезагружает все карты (player/nick/IP/UUID/alts). | - | `/tdn reload` |
| `/tdn list` | Показывает список всех игроков с активными модификаторами, их типом, оставшимся временем действия и причиной (если применимо). Отображает онлайн/UUID. | - | `/tdn list` |
| `/tdn clear <игрок>` | Снимает все модификаторы урона с указанного игрока (playerMods), возвращая PvP в стандартное состояние. Не трогает nick/IP/UUID. | `<игрок>` (онлайн). | `/tdn clear Steve` |
| `/tdn nicklist` | Показывает список всех ников с активными модификаторами, связанными IP, альтами и временем/причиной. | - | `/tdn nicklist` |
| `/tdn alts <nick>` | Показывает список альт-аккаунтов (история ников по IP) для указанного ника. Находит IP по bind (UUID/IP). | `<nick>` (онлайн или из истории). | `/tdn alts DomerPidoras` |
| `/tdn nickclear <nick>` | Снимает модификатор с ника, применяет NORMAL для всех онлайн с bound IP/UUID. | `<nick>` (из истории или онлайн). | `/tdn nickclear oldnick` |
| `/tdn ipclear <nick>` | Снимает модификатор по IP (через ник, авто-bind). Применяет NORMAL для онлайн с IP. | `<nick>` (онлайн для авто-IP). | `/tdn ipclear newnick` |
| `/tdn ipdisable <nick> [время] [причина]` | Отключает PvP для ника/IP/UUID (авто-bind). Работает как disable, но для альтов. Уведомление админам при alt-join. | `<nick>` (онлайн), [время], [причина]. | `/tdn ipdisable DomerPidoras 0 бан` |
| `/tdn ipreduce <nick> [время]` | Снижает урон для ника/IP/UUID (авто-bind). | `<nick>` (онлайн), [время]. | `/tdn ipreduce DomerPidoras 30m` |
| `/tdn ipamplify <nick> [время]` | Увеличивает входящий урон для ника/IP/UUID (авто-bind). | `<nick>` (онлайн), [время]. | `/tdn ipamplify DomerPidoras` |

**Уведомления об альтах:** Автоматически для админов (`tdn.admin`) при входе с bound IP новым ником и активным модом: "Игрок [oldnick] зашёл с нового аккаунта [newnick]. Модификатор [mod] применён. IP: [ip]".

---

## Конфигурация

### config.yml
Автоматически генерируется. Секции:
- **player-modifiers** (UUID): Временные моды игроков.
- **nick-modifiers** (nick): Основные моды ников.
- **ip-bindings** (IP): Привязки IP → nick.
- **uuid-bindings** (UUID): Привязки UUID → nick (перманентные).
- **ip-alts** (IP): История альтов (nicks: []).

Авто-очистка старых NORMAL-полей. Пример:
```yaml
nick-modifiers:
  domerpidoras:
    modifier: DISABLED
    expiry: 0
    reason: "бан"
ip-bindings:
  192.168.1.100:
    nick: domerpidoras
uuid-bindings:
  123e4567-e89b-12d3-a456-426614174000:
    nick: domerpidoras
ip-alts:
  192.168.1.100:
    nicks: ["domerpidoras", "newalt"]
```

### messages.yml
Кастомные сообщения. Пример:
```yaml
pvp_disabled: "§cВаш PvP отключен. Причина: %reason%. Время: %time%"
alt_notification: "§c[TDN] Игрок %oldnick% зашёл с %newnick%. Mod: %mod%. IP: %ip%"
```

## Примеры использования

- **Отключение PvP:** `/tdn disable Steve 10m Нарушение правил` — отключить Steve на 10 мин с причиной.
- **Снижение урона:** `/tdn reduce Alex 5m` — снизить урон Alex на 5 мин.
- **Усиление урона:** `/tdn amplify Bob 1h` — усилить урон по Bob на 1 час.
- **IP-based отключение:** `/tdn ipdisable DomerPidoras 0 бан` — отключить для nick/IP/UUID (авто-bind).
- **Сброс:** `/tdn clear Steve` — сбросить моды Steve.
- **Статус:** `/tdn status Steve` — статус Steve.
- **Список:** `/tdn list` — список игроков с модами.
- **Список ников/IP/alts:** `/tdn nicklist` — список ников/IP/alts.
- **Альты:** `/tdn alts DomerPidoras` — альты для DomerPidoras.
- **Сброс по нику:** `/tdn nickclear oldnick` — сброс по нику.
- **Перезагрузка:** `/tdn reload` — перезагрузка.

## Устранение неисправностей
- **Mod не применяется:** Проверьте bind (UUID/IP) в config. Используйте `/tdn reload`.
- **Нет уведомлений об альтах:** Убедитесь в perm `tdn.admin`.
- **Ошибки в логах:** Проверьте совместимость с версией сервера (1.16+). Сообщите в [Issues](https://github.com/sipilen/TrueDamageNullifier/issues).
- **Очистка config:** Удалите старые NORMAL в player-modifiers для оптимизации.

## Поддержка
- **Репозиторий:** [GitHub](https://github.com/sipilen/TrueDamageNullifier)
- **Issues:** [Создать issue](https://github.com/sipilen/TrueDamageNullifier/issues/new)
- **Релизы:** [Скачать](https://github.com/sipilen/TrueDamageNullifier/releases)
- **Discord:** [MineGame](https://discord.gg/rb595Q6hK2).

Плагин лёгкий, без зависимостей. Если нужны доработки — telegram @sipilen!
